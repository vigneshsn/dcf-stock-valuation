<div>
    <h1>Value a Stock with Discounted Cash Flow (DCF)</h1>
    <p class="lead">
        Learn how to estimate what a stock is truly worth not just what the market says.
        This simple step-by-step guide helps you value a company using future cash flow projections.
    </p>

    <div class="card">
        <h2>Why Value a Stock?</h2>
        <p class="muted">
            Valuing a stock helps you make smarter investing decisions. Instead of blindly buying or selling
            based on the market price, you understand what the business is <em>actually worth</em>
            based on the cash it can generate in the future.
        </p>
        <p>
            Benjamin Graham, the legendary value investor and author of <strong>The Intelligent Investor</strong>,
            compared the stock market to a person named <strong>‚ÄúMr. Market.‚Äù</strong> Sometimes he‚Äôs excited
            and offers stocks at high prices, sometimes he‚Äôs fearful and sells them cheap.
            By doing your own valuation, you can decide whether Mr. Market‚Äôs price is a bargain or a trap.
        </p>
        <div class="note">
            üí° Example: If Mr. Market offers a stock at ‚Çπ100 but your valuation says it‚Äôs worth ‚Çπ150,
            that‚Äôs a potential buying opportunity!
        </div>
    </div>

    <div class="card">
        <h2>What is Discounted Cash Flow (DCF)?</h2>
        <p>
            Think of a business as a <strong>machine that prints cash every year</strong>.
            Warren Buffett often calls this the business‚Äôs <strong>‚Äúowner earnings‚Äù</strong> ‚Äî
            the real cash a company can generate for its owners after paying for all necessary
            expenses and maintenance.
        </p>
        <p>
            The <strong>Discounted Cash Flow (DCF)</strong> model asks:
            ‚ÄúHow much are all those future cash prints worth in today‚Äôs money?‚Äù
            Because a rupee today is worth more than a rupee in the future,
            we <strong>discount</strong> future cash to its present value.
        </p>
        <p>
            Add up these discounted future cash flows, include a <strong>terminal value</strong>
            for the years beyond your forecast, and you‚Äôll get a reasonable estimate
            of what the company is worth today ‚Äî its <strong>intrinsic value</strong>.
        </p>
    </div>

    <div class="card">
        <h2>Owner Earnings</h2>
        <p class="muted">
            Owner earnings represent the <strong>real cash</strong> a company makes for its owners
            after paying all necessary expenses and maintaining its operations.
            Unlike accounting profits, it shows how much money is truly available for shareholders ‚Äî
            to pay dividends, reduce debt, or reinvest for growth.
        </p>
        <p>
            Think of this as the company‚Äôs ‚Äútake-home pay‚Äù ‚Äî what‚Äôs left after running the business
            and maintaining its assets.
        </p>
        <div class="note">
            <strong>Formula:</strong><br>
            Owner Earnings = Net Profit + Depreciation & Amortization ‚àí Capital Expenditures
        </div>
    </div>

    <div class="card">
        <h2>How to Use This Calculator</h2>
        <p class="muted">
            Start by entering a few key financial figures ‚Äî such as revenue, net profit, capital expenditure,
            and depreciation ‚Äî which you can easily find on
            <a href="https://www.screener.in/" target="_blank">Screener.in</a>
            or in the company‚Äôs annual report.
            It‚Äôs best to take the <strong>3-year average</strong> to smooth out one-time spikes.
        </p>

        <p>
            The calculator projects the company‚Äôs future <strong>owner earnings</strong>,
            discounts them to the present value, and adds the terminal value.
            The result is your estimate of <strong>intrinsic value</strong>.
        </p>

        <p>
            Finally, apply the <strong>Margin of Safety</strong> principle:
            buy only if the current market price is <strong>20‚Äì30% below</strong> your estimated value.
            This cushions you against forecast errors and market volatility.
        </p>
        <p>
            <strong>Disclaimer:</strong> This calculator is for educational purposes only.
            It simplifies valuation concepts and may not capture every real-world factor.
            Always research thoroughly or consult a financial advisor before making investment decisions.
        </p>
        <div class="guide-toggle">
            <label class="switch">
                <input type="checkbox" [(ngModel)]="showGuides" />
                <span class="slider"></span>
            </label>
            <span style="margin-left: 0.5rem;">
                {{ showGuides ? 'Hide visual guides' : 'Show visual guides' }}
            </span>
        </div>
    </div>

</div>

<!-- Revenue Card -->
<div class="card">
    <h2>Revenue</h2>
    <p>Revenue is the total money a company earns from selling products or services before paying any costs or expenses.</p>
    <p>You can find this information in Income Statement or Profit & loss statement.</p>
    <div class="row">
        <div class="col">
            <label>First 3 year average</label>
            <input type="number" [(ngModel)]="revenueLeastRecentAvg" step="any" (ngModelChange)="calculateGrowthRate()" [min]=0 required/>
        </div>
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="revenueMostRecentAvg" step="any" (ngModelChange)="calculateGrowthRate()" [min]=0  required/>
        </div>
        <div class="col">
            <label>Growth period in years</label>
            <input type="number" [(ngModel)]="revenueYears" step="any" (ngModelChange)="calculateGrowthRate()" [min]=0  required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/revenue.png" alt="Revenue" class="card-image">

    <div class="note">
        <strong>Compounded annual growth rate of revenue is used in DCF</strong><br>
        GrowthRate % = ((Ending Value / Beginning Value)^(1/years) - 1) * 100
    </div>
</div>

<!-- Net Profit Card -->
<div class="card">
    <h2>Net Profit</h2>
    <p>Net profit is what remains after paying all expenses like salaries, rent, taxes, interest, and other costs. It‚Äôs the company‚Äôs ‚Äúreal earnings.‚Äù</p>
    <p>You can find this information in Income Statement or Profit & loss statement.</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="netProfitAverage" step="any"  [min]=0  required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/profit.png" alt="profit" class="card-image">
</div>

<!-- Non-Cash Expenditure Card -->
<div class="card">
    <h2>Depreciation and Amortization </h2>
    <p>Depreciation & Amortization (D&A) are non-cash expenses recorded on the income statement, but not paid out in actual cash. They represent the gradual reduction in value of assets over time.</p>
    <p>You can find this information in Income Statement or Profit & loss statement.</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="nonCashExAverage" step="any" [min]=0  required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/d&a.png" alt="non-cash expense" class="card-image">
</div>


<!-- Capital Expenditure Card -->
<div class="card">
    <h2>Capital Expenditure</h2>
    <p>Capital Expenditure often called "CapEx" is the money a company spends to buy, maintain, or upgrade its long-term assets like buildings, machines, vehicles, or technology. These are investments that help the business operate and grow over many years.</p>
    <p>You can find this information in Cash Flow statement under the Investing Activities section. sometimes stated as purchase of Property Plant & Equipment (PPE).</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="capExAverage" step="any" [min]=0  required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/capex.png" alt="capex" class="card-image">
</div>

<div *ngIf="calculationResults" class="results-section">
    <h3>DCF Analysis Results</h3>

    <!-- Projections Table -->
    <div class="table-container">
        <h4>Owner Earnings Projections</h4>
        <table class="projections-table">
            <thead>
            <tr>
                <th>Year</th>
                <th>Present Value</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let projection of projections; let i = index">
                <td>{{ projection.year }}</td>
                <td>{{ projection.discountedOwnerEarning }}</td>
            </tr>
            <tr class="terminal-row">
                <td>Discounted terminal value</td>
                <td>{{ discountedTerminalValue }}</td>
            </tr>
            </tbody>
            <tfoot>
            <tr class="total-row">
                <td><strong>Total Present Value</strong></td>
                <td><strong>{{ dcfValue }}</strong></td>
            </tr>
            </tfoot>
        </table>
    </div>

    <!-- Fair Value Summary -->
    <div class="fair-value-summary">
        <h4>Intrinsic Value Analysis</h4>
        <div class="summary-grid">
            <div class="summary-item">
                <label>Fair Value per Share:</label>
                <span>{{ intrinsicValuePerShare }}</span>
            </div>
            <div class="summary-item">
                <label>Current Market Price:</label>
                <span>{{ currentPrice }}</span>
            </div>
            <div class="summary-item" [class]="getValuationClass()">
                <label>Valuation:
                    <span class="info-icon"
                          title="margin of safety 20% is applied to intrinsic value to determine if stock is undervalued or overvalued">
                    ‚ÑπÔ∏è
                </span></label>
                <span>{{ getValuationText() }}</span>
            </div>
        </div>
        <div class="note small">
            <h4>üí° Practical tips</h4>
            <p>
                DCF results depend on your assumptions. Try three versions ‚Äî
                <strong>Optimistic</strong> (higher growth rate),
                <strong>Realistic</strong> (average past performance), and
                <strong>Pessimistic</strong> (lower growth rate).
            </p>
            <p>
                Use a sensible <strong>discount rate</strong> (10‚Äì15%) and keep growth expectations realistic.
                Always apply a <strong>margin of safety</strong> ‚Äî buy only if the stock price is at least
                <strong>20‚Äì30% below</strong> your estimated value.
            </p>
        </div>
    </div>

</div>

<div class="card">
    <h2>Calculate intrinsic value of stock</h2>
   <div class="row">
       <div class="col">
           <label>
               Growth rate %
               <span class="info-icon"
                     title="Calculated based on revenue growth over the years">
                    ‚ÑπÔ∏è
                </span>
           </label>
           <input type="number" [(ngModel)]="growthRate" step="any" required/>
       </div>
        <div class="col">
            <label>
                Discount rate %
                <span class="info-icon tooltip-container">
                  ‚ÑπÔ∏è
                  <span class="custom-tooltip">
                    The rate used to bring future cash flows to today‚Äôs value ‚Äî essentially your expected rate of return for investing in this stock.
                  </span>
                </span>
            </label>
            <input type="number" [(ngModel)]="discountRate" step="any" required/>
        </div>
        <div class="col">
            <label>
                Terminal growth rate %
                <span class="info-icon tooltip-container">
                  ‚ÑπÔ∏è
                  <span class="custom-tooltip">
                    The expected growth rate of the company's cash flows after the projection period. I will generally use inflation rate for conservative estimate (typically 4-6% for indian stock market)
                  </span>
                </span>
            </label>
            <input type="number" [(ngModel)]="terminalGrowthRate" step="any" required/>
        </div>
        <div class="col">
            <label>
                Current Market cap
                <span class="info-icon tooltip-container">
                  ‚ÑπÔ∏è
                  <span class="custom-tooltip">
                    The current market value of the company (current stock price √ó number of shares outstanding)
                  </span>
                </span>
            </label>
            <input type="number" [(ngModel)]="marketValue" step="any" [min]=0 required/>
        </div>
        <div class="col">
            <label>
                Current price
                <span class="info-icon"
                      title="The current trading price per share of the company's stock">
                    ‚ÑπÔ∏è
                </span>
            </label>
            <input type="number" [(ngModel)]="currentPrice" step="any" [min]=0 required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/marktcap.png" alt="market cap" class="card-image">
    <div class="row">
        <div class="col button-container">
            <button class="btn" (click)="calculateIntrinsicValue()">Calculate</button>
        </div>
        <div class="col button-container">
            <button class="btn" (click)="resetForm()">Reset</button>
        </div>
    </div>


</div>

