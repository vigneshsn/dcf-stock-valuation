<div class="guide-toggle">
    <button class="btn-link" (click)="toggleGuides()">
        {{ showGuides ? 'Hide visual guides' : 'Show visual guides' }}
    </button>
</div>

<!-- Revenue Card -->
<div class="card">
    <h2>Revenue</h2>
    <p>Revenue is the total money a company earns from selling products or services before paying any costs or expenses.</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="revenueMostRecentAvg" (ngModelChange)="calculateGrowthRate()" required/>
        </div>
        <div class="col">
            <label>First 3 year average</label>
            <input type="number" [(ngModel)]="revenueLeastRecentAvg" (ngModelChange)="calculateGrowthRate()" required/>
        </div>
        <div class="col">
            <label>Growth period in years</label>
            <input type="number" [(ngModel)]="revenueYears" (ngModelChange)="calculateGrowthRate()" required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/revenue.png" alt="Revenue" class="card-image">
</div>

<!-- Net Profit Card -->
<div class="card">
    <h2>Net Profit</h2>
    <p>Net profit is what remains after paying all expenses like salaries, rent, taxes, interest, and other costs. It‚Äôs the company‚Äôs ‚Äúreal earnings.‚Äù</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="netProfitAverage" required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/profit.png" alt="profit" class="card-image">
</div>

<!-- Capital Expenditure Card -->
<div class="card">
    <h2>Capital Expenditure</h2>
    <p>Capital Expenditure often called "CapEx" is the money a company spends to buy, maintain, or upgrade its long-term assets like buildings, machines, vehicles, or technology. These are investments that help the business operate and grow over many years.</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="capExAverage" required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/capex.png" alt="capex" class="card-image">
</div>

<!-- Non-Cash Expenditure Card -->
<div class="card">
    <h2>Depreciation and Amortization </h2>
    <p>Depreciation & Amortization (D&A) are non-cash expenses recorded on the income statement, but not paid out in actual cash. They represent the gradual reduction in value of assets over time.</p>
    <div class="row">
        <div class="col">
            <label>Last 3 year average</label>
            <input type="number" [(ngModel)]="nonCashExAverage" required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/d&a.png" alt="non-cash expense" class="card-image">
</div>

<div class="card">
    <h2>Calculate Fair value of stock</h2>
   <div class="row">
       <div class="col">
           <label>
               Growth rate %
               <span class="info-icon"
                     title="Calculated based on revenue growth over the years">
                    ‚ÑπÔ∏è
                </span>
           </label>
           <input type="number" [(ngModel)]="growthRate" required/>
       </div>
        <div class="col">
            <label>
                Discount rate %
                <span class="info-icon"
                      title="The rate used to bring future cash flows to today‚Äôs value ‚Äî essentially your expected rate of return for investing in this stock.">
                    ‚ÑπÔ∏è
                </span>
            </label>
            <input type="number" [(ngModel)]="discountRate" required/>
        </div>
        <div class="col">
            <label>
                Terminal growth rate %
                <span class="info-icon"
                      title="The expected growth rate of the company's cash flows after the projection period. I will generally use inflation rate for conservative estimate (typically 4-6% for indian stock market)">
                    ‚ÑπÔ∏è
                </span>
            </label>
            <input type="number" [(ngModel)]="terminalGrowthRate" required/>
        </div>
        <div class="col">
            <label>
                Current Market value
                <span class="info-icon"
                      title="The total market capitalization of the company (current stock price √ó number of shares outstanding)">
                    ‚ÑπÔ∏è
                </span>
            </label>
            <input type="number" [(ngModel)]="marketValue" required/>
        </div>
        <div class="col">
            <label>
                Current price
                <span class="info-icon"
                      title="The current trading price per share of the company's stock">
                    ‚ÑπÔ∏è
                </span>
            </label>
            <input type="number" [(ngModel)]="currentPrice" required/>
        </div>
    </div>
    <img *ngIf="showGuides"  src="assets/images/marktcap.png" alt="market cap" class="card-image">
    <div class="row">
        <div class="col button-container">
            <button class="btn" (click)="calculateIntrinsicValue()">Calculate</button>
        </div>
        <div class="col button-container">
            <button class="btn" (click)="resetForm()">Reset</button>
        </div>
    </div>

    <div *ngIf="calculationResults" class="results-section">
        <h3>DCF Analysis Results</h3>

        <!-- Projections Table -->
        <div class="table-container">
            <h4>Owner Earnings Projections</h4>
            <table class="projections-table">
                <thead>
                <tr>
                    <th>Year</th>
                    <th>Present Value</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let projection of projections; let i = index">
                    <td>{{ projection.year }}</td>
                    <td>{{ projection.discountedOwnerEarning }}</td>
                </tr>
                <tr class="terminal-row">
                    <td>Discounted terminal value</td>
                    <td>{{ discountedTerminalValue }}</td>
                </tr>
                </tbody>
                <tfoot>
                <tr class="total-row">
                    <td><strong>Total Present Value</strong></td>
                    <td><strong>{{ dcfValue }}</strong></td>
                </tr>
                </tfoot>
            </table>
        </div>

        <!-- Fair Value Summary -->
        <div class="fair-value-summary">
            <h4>Fair Value Analysis</h4>
            <div class="summary-grid">
                <div class="summary-item">
                    <label>Fair Value per Share:</label>
                    <span>{{ intrinsicValuePerShare }}</span>
                </div>
                <div class="summary-item">
                    <label>Current Market Price:</label>
                    <span>{{ currentPrice }}</span>
                </div>
                <div class="summary-item" [class]="getValuationClass()">
                    <label>Valuation:</label>
                    <span>{{ getValuationText() }}</span>
                </div>
            </div>
            <div class="note small">
                <h4>üí° Tips</h4>
                <p>
                    DCF results depend on your assumptions. Try three versions ‚Äî
                    <strong>Optimistic</strong> (higher growth rate),
                    <strong>Realistic</strong> (average past performance), and
                    <strong>Pessimistic</strong> (lower growth rate).
                </p>
                <p>
                    Use a sensible <strong>discount rate</strong> (10‚Äì15%) and keep growth expectations realistic.
                    Always apply a <strong>margin of safety</strong> ‚Äî buy only if the stock price is at least
                    <strong>20‚Äì30% below</strong> your estimated value.
                </p>
            </div>
        </div>

    </div>
</div>

